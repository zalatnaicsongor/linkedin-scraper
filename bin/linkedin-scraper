#!/usr/bin/env ruby
require 'io/console'
require 'net/http'
require 'uri'

require_relative '../lib/linkedin-scraper'
#profile = Linkedin::Profile.new(ARGV[0])
#puts JSON.pretty_generate JSON.parse(profile.to_json)

print 'Linkedin Username: '
username = gets.chomp
print 'Linkedin Password: '
password = STDIN.noecho(&:gets)
puts ''
puts 'please wait until the processing has completed and please do not close the browser!'

browser = Linkedin::HTTPClientFactory.create_authencticated_browser(username, password)

access_token_cookie = (browser.cookies.to_a.select { |cookie| cookie[:name] == "li_at" })

mechanize = Mechanize.new

me = Linkedin::Profile.me(browser, access_token_cookie[0][:value])

#me.connections.each do |connection|
#	puts connection
#end

File.open(me.id + "_self.json", 'w') { |file| file.write(me.to_json) }

#other = Linkedin::Profile.get_profile(browser, me.connections[2])
#File.open(other.id + "_1degree.json", 'w') { |file| file.write(other.to_json) }
#puts other.to_json

#headlessClient = Linkedin::HTTPClientFactory.create_authenticated_headless(username, password)
#puts headlessClient.get('https://www.linkedin.com/contacts/api/contacts/?start=0&count=9999&fields=id%2Cname%2Cfirst_name%2Clast_name%2Ccompany%2Ctitle%2Cgeo_location%2Ctags%2Cemails%2Csources%2Cdisplay_sources%2Clast_interaction%2Csecure_profile_image_url&sort=-last_interaction&_=1427699884550').body
